# FinHelper Backend API - –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## ‚úÖ –í—Å–µ API endpoints —Ä–∞–±–æ—Ç–∞—é—Ç –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

---

## –°—Ç–∞—Ç—É—Å –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

### üè• Health Check
- ‚úÖ `GET /healthz` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### üìã Account Consents (3/3)
- ‚úÖ `POST /api/consents` - —Å–æ–∑–¥–∞—Ç—å consent
- ‚úÖ `GET /api/consents/{id}` - —Å—Ç–∞—Ç—É—Å consent
- ‚úÖ `DELETE /api/consents/{id}` - –æ—Ç–æ–∑–≤–∞—Ç—å consent

### üí≥ Accounts & Balances (4/4)
- ‚úÖ `POST /api/banks/{bank}/connect` - –ø–æ–¥–∫–ª—é—á–∏—Ç—å –±–∞–Ω–∫ (legacy)
- ‚úÖ `GET /api/accounts` - —Å–ø–∏—Å–æ–∫ —Å—á–µ—Ç–æ–≤
- ‚úÖ `GET /api/accounts/{id}/balances` - –±–∞–ª–∞–Ω—Å—ã —Å—á–µ—Ç–∞
- ‚úÖ `GET /api/accounts/{id}/transactions` - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å—á–µ—Ç–∞

### üí∏ Transactions (1/1)
- ‚úÖ `GET /api/transactions` - –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### üîê Payment Consents (2/2)
- ‚úÖ `POST /api/payment-consents` - —Å–æ–∑–¥–∞—Ç—å payment consent
- ‚úÖ `GET /api/payment-consents/{id}` - —Å—Ç–∞—Ç—É—Å payment consent

### üí∞ Payments (2/2)
- ‚úÖ `POST /api/payments` - —Å–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂
- ‚úÖ `GET /api/payments/{id}` - —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞

### üîí Product Agreement Consents (2/2)
- ‚úÖ `POST /api/pa-consents` - —Å–æ–∑–¥–∞—Ç—å PA consent
- ‚úÖ `GET /api/pa-consents/{id}` - —Å—Ç–∞—Ç—É—Å PA consent

### üè¶ Products (1/1)
- ‚úÖ `GET /api/products` - —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –±–∞–Ω–∫–∞

### üìù Agreements (4/4)
- ‚úÖ `POST /api/agreements` - –æ—Ç–∫—Ä—ã—Ç—å –¥–æ–≥–æ–≤–æ—Ä
- ‚úÖ `GET /api/agreements` - —Å–ø–∏—Å–æ–∫ –¥–æ–≥–æ–≤–æ—Ä–æ–≤
- ‚úÖ `GET /api/agreements/{id}` - –¥–µ—Ç–∞–ª–∏ –¥–æ–≥–æ–≤–æ—Ä–∞
- ‚úÖ `DELETE /api/agreements/{id}` - –∑–∞–∫—Ä—ã—Ç—å –¥–æ–≥–æ–≤–æ—Ä

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | Endpoints | –°—Ç–∞—Ç—É—Å |
|-----------|-----------|--------|
| Health Check | 1 | ‚úÖ 100% |
| Account Consents | 3 | ‚úÖ 100% |
| Accounts & Balances | 4 | ‚úÖ 100% |
| Transactions | 1 | ‚úÖ 100% |
| Payment Consents | 2 | ‚úÖ 100% |
| Payments | 2 | ‚úÖ 100% |
| PA Consents | 2 | ‚úÖ 100% |
| Products | 1 | ‚úÖ 100% |
| Agreements | 4 | ‚úÖ 100% |
| **–í–°–ï–ì–û** | **20** | ‚úÖ **100%** |

---

## üéØ –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π Open Banking API

### ‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ Bank token (JWT RS256) —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
- ‚úÖ Thread-safe —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
- ‚úÖ `Authorization: Bearer <token>`
- ‚úÖ `X-Requesting-Bank` (–¥–ª—è –º–µ–∂–±–∞–Ω–∫–∞)
- ‚úÖ `X-Consent-Id` (–¥–ª—è —Å—á–µ—Ç–æ–≤)
- ‚úÖ `X-Payment-Consent-Id` (–¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π)
- ‚úÖ `X-Product-Agreement-Consent-Id` (–¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤)

### ‚úÖ Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- ‚úÖ `client_id` –¥–æ–±–∞–≤–ª–µ–Ω –≤–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–µ—Ç–æ–¥—ã

### ‚úÖ –§–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ JSON –¥–ª—è —Ç–µ–ª –∏ –æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ –°—É–º–º—ã –∫–∞–∫ —Å—Ç—Ä–æ–∫–∏ ("500.00")
- ‚úÖ –î–∞—Ç—ã –≤ ISO-8601

### ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ 401 Unauthorized
- ‚úÖ 403 Forbidden
- ‚úÖ 422 Validation Error
- ‚úÖ Retry –ª–æ–≥–∏–∫–∞ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π

### ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ consent'–æ–≤ (account, payment, PA)
- ‚úÖ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ Request ID –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –º–∞—Å–∫–∏—Ä–æ–≤–∫–æ–π —Ç–æ–∫–µ–Ω–æ–≤

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

### Backend:
```bash
cd finhelper/backend
./finhelper-backend
```

Backend –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:8080`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è:
```bash
curl http://localhost:8080/healthz
```

–û—Ç–≤–µ—Ç:
```json
{
  "status": "ok",
  "timestamp": "2025-11-08T20:00:00Z",
  "banks": 3
}
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –≤—Å–µ—Ö endpoints:
üëâ **[frontend/API_INTEGRATION.md](../frontend/API_INTEGRATION.md)**

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env):
```env
TEAM_ID=team053
CLIENT_SECRET=EdmB1m5yQ0PjSqEuccSMhyxwq1fo5ITW
BANKS=vbank,abank,sbank
BASE_URL_VBANK=https://vbank.open.bankingapi.ru
BASE_URL_ABANK=https://abank.open.bankingapi.ru
BASE_URL_SBANK=https://sbank.open.bankingapi.ru
PORT=8080
CORS_ORIGIN=http://localhost:5173
```

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –±–∞–Ω–∫–∏:
- ‚úÖ vbank
- ‚úÖ abank
- ‚úÖ sbank

---

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–†–∞–∑–º–µ—Ä –±–∏–Ω–∞—Ä–Ω–∏–∫–∞:** 9.5 MB
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** 3316
- **–í—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏:** ~2 —Å–µ–∫—É–Ω–¥—ã
- **Timeout –∑–∞–ø—Ä–æ—Å–æ–≤:** 90 —Å–µ–∫—É–Ω–¥
- **Retry –ø–æ–ø—ã—Ç–æ–∫:** 3 —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
- **–ö—ç—à —Ç–æ–∫–µ–Ω–æ–≤:** 24 —á–∞—Å–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞ 60 —Å–µ–∫ –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è)

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è Open Banking API —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç!**

–§—Ä–æ–Ω—Ç–µ–Ω–¥ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±–æ–π –∏–∑ 20 endpoints –¥–ª—è:
- üìä –ü—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—á–µ—Ç–æ–≤ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- üí∏ –í—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
- üè¶ –û—Ç–∫—Ä—ã—Ç–∏—è –≤–∫–ª–∞–¥–æ–≤, –∫—Ä–µ–¥–∏—Ç–æ–≤ –∏ –∫–∞—Ä—Ç
- üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞–º–∏
- üîí –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–∏—è–º–∏ (consents)

Backend –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏! üöÄ
