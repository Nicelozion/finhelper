
# Backend - –ê–≥—Ä–µ–≥–∞—Ç–æ—Ä –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö API

–ë—ç–∫–µ–Ω–¥-—Å–µ—Ä–≤–∏—Å –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö API. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Å–µ–Ω—Ç–∞–º–∏, —Å—á–µ—Ç–∞–º–∏, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏, –ø–ª–∞—Ç–µ–∂–∞–º–∏ –∏ –±–∞–Ω–∫–æ–≤—Å–∫–∏–º–∏ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏.

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [API Endpoints](#api-endpoints)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-api)
- [–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫](#—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–Ω–µ–ø–æ–ª–∞–¥–æ–∫)

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **–Ø–∑—ã–∫**: Go 1.25.3+
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: RESTful HTTP API
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
  - `github.com/google/uuid` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è UUID –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
  - `github.com/joho/godotenv` - –∑–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Go 1.25.3 –∏–ª–∏ –≤—ã—à–µ
- –î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É (–¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–∞–Ω–∫–æ–≤—Å–∫–∏–º–∏ API)
- –ü–æ—Ä—Ç 8080 —Å–≤–æ–±–æ–¥–µ–Ω (–∏–ª–∏ –¥—Ä—É–≥–æ–π —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Go

**Windows:**
---
```powershell
# –°–∫–∞—á–∞–π—Ç–µ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫ —Å https://go.dev/dl/
# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ chocolatey:
choco install golang
```
---

**macOS:**
---
```bash
brew install go
```
---

**Linux:**
---
```bash
wget https://go.dev/dl/go1.25.3.linux-amd64.tar.gz
sudo tar -C /usr/local -xzf go1.25.3.linux-amd64.tar.gz
export PATH=$PATH:/usr/local/go/bin
```
---

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É:
---
```bash
go version
```
---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é

---
```bash
cd backend
```
---

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

---
```bash
go mod download
```
---

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª —Å –ø—Ä–∏–º–µ—Ä–æ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

---
```bash
# Windows (PowerShell)
copy .env.example .env

# Linux/macOS
cp .env.example .env
```
---

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` —Ñ–∞–π–ª, —É–∫–∞–∑–∞–≤ –≤–∞—à–∏ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:

---
```env
TEAM_ID=team053
CLIENT_SECRET=EdmB1m5yQ0PjSqEuccSMhyxwq1fo5ITW
BANKS=vbank,abank,sbank
BASE_URL_VBANK=https://vbank.open.bankingapi.ru
BASE_URL_ABANK=https://abank.open.bankingapi.ru
BASE_URL_SBANK=https://sbank.open.bankingapi.ru
PORT=8080
CORS_ORIGIN=http://localhost:5173
```
---

### 4. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

**–†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π):**
---
```bash
go run main.go
```
---

**–°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫:**
---
```bash
# –°–±–æ—Ä–∫–∞
go build -o backend.exe main.go

# –ó–∞–ø—É—Å–∫
./backend.exe        # Windows
./backend            # Linux/macOS
```
---

**–í—ã–≤–æ–¥ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –∑–∞–ø—É—Å–∫–µ:**
---
```
Server starting on port 8080
```
---

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

---
```bash
# Health check
curl http://localhost:8080/health

# –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
{"status":"ok"}
```
---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ —Ñ–∞–π–ª `.env`:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π |
|----------|----------|----------------------|--------------|
| `TEAM_ID` | ID –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö API | - | –î–∞ |
| `CLIENT_SECRET` | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ | - | –î–∞ |
| `BANKS` | –°–ø–∏—Å–æ–∫ –±–∞–Ω–∫–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é | - | –î–∞ |
| `BASE_URL_VBANK` | URL API –¥–ª—è vbank | - | –î–∞ (–µ—Å–ª–∏ vbank –≤ BANKS) |
| `BASE_URL_ABANK` | URL API –¥–ª—è abank | - | –î–∞ (–µ—Å–ª–∏ abank –≤ BANKS) |
| `BASE_URL_SBANK` | URL API –¥–ª—è sbank | - | –î–∞ (–µ—Å–ª–∏ sbank –≤ BANKS) |
| `PORT` | –ü–æ—Ä—Ç HTTP —Å–µ—Ä–≤–µ—Ä–∞ | 8080 | –ù–µ—Ç |
| `CORS_ORIGIN` | CORS origin –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ | http://localhost:5173 | –ù–µ—Ç |

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –±–∞–Ω–∫–∞

1. –î–æ–±–∞–≤—å—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `BANKS`:
---
```env
BANKS=vbank,abank,sbank,newbank
```
---

2. –î–æ–±–∞–≤—å—Ç–µ URL –¥–ª—è –Ω–æ–≤–æ–≥–æ –±–∞–Ω–∫–∞:
---
```env
BASE_URL_NEWBANK=https://newbank.open.bankingapi.ru
```
---

## API Endpoints

### Health Check

---
```http
GET /health
GET /healthz
```
---

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞.

**–û—Ç–≤–µ—Ç:**
---
```json
{"status":"ok"}
```
---

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Å–µ–Ω—Ç–∞–º–∏ (–¥–æ—Å—Ç—É–ø –∫ —Å—á–µ—Ç–∞–º)

#### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Å–µ–Ω—Ç–∞

---
```http
POST /api/consents?bank=vbank&user=user123
```
---

**–û—Ç–≤–µ—Ç:**
---
```json
{
  "consentId": "consent-uuid-...",
  "status": "AwaitingAuthorisation",
  "creationDateTime": "2024-01-15T10:30:00Z",
  "statusUpdateDateTime": "2024-01-15T10:30:00Z"
}
```
---

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Å–µ–Ω—Ç–∞

---
```http
GET /api/consents/{consentId}?bank=vbank
```
---

#### –û—Ç–∑—ã–≤ –∫–æ–Ω—Å–µ–Ω—Ç–∞

---
```http
DELETE /api/consents/{consentId}?bank=vbank
```
---

### –°—á–µ—Ç–∞ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å—á–µ—Ç–æ–≤

---
```http
GET /api/accounts?user=user123&bank=vbank
```
---

**–û—Ç–≤–µ—Ç:**
---
```json
{
  "accounts": [
    {
      "accountId": "acc-001",
      "currency": "RUB",
      "accountType": "Personal",
      "accountSubType": "CurrentAccount",
      "nickname": "–û—Å–Ω–æ–≤–Ω–æ–π —Å—á–µ—Ç"
    }
  ]
}
```
---

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ —Å—á–µ—Ç–∞

---
```http
GET /api/accounts/{accountId}/balances?bank=vbank&user=user123
```
---

**–û—Ç–≤–µ—Ç:**
---
```json
{
  "balances": [
    {
      "accountId": "acc-001",
      "creditDebitIndicator": "Credit",
      "type": "InterimAvailable",
      "dateTime": "2024-01-15T10:30:00Z",
      "amount": {
        "amount": "15000.50",
        "currency": "RUB"
      }
    }
  ]
}
```
---

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å—á–µ—Ç–∞

---
```http
GET /api/accounts/{accountId}/transactions?bank=vbank&user=user123
```
---

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∑–∞ –ø–µ—Ä–∏–æ–¥

---
```http
GET /api/transactions?user=user123&bank=vbank&from=2024-01-01&to=2024-01-31
```
---

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `from` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –¥–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD
- `to` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD

### –ü–ª–∞—Ç–µ–∂–∏

#### –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ –∫–æ–Ω—Å–µ–Ω—Ç–∞

---
```http
POST /api/payment-consents?bank=vbank&user=user123
Content-Type: application/json

{
  "debtorAccount": {
    "identification": "40817810099910004312"
  },
  "instructedAmount": {
    "amount": "1000.00",
    "currency": "RUB"
  },
  "creditorAccount": {
    "identification": "40817810099910005678"
  }
}
```
---

#### –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞

---
```http
POST /api/payments?bank=vbank&user=user123
Content-Type: application/json

{
  "paymentConsentId": "payment-consent-uuid"
}
```
---

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞

---
```http
GET /api/payments/{paymentId}?bank=vbank&user=user123
```
---

### –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã –∏ –¥–æ–≥–æ–≤–æ—Ä—ã

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤

---
```http
GET /api/products?bank=vbank&user=user123&type=DEPOSIT
```
---

**–¢–∏–ø—ã –ø—Ä–æ–¥—É–∫—Ç–æ–≤:**
- `DEPOSIT` - –≤–∫–ª–∞–¥—ã
- `LOAN` - –∫—Ä–µ–¥–∏—Ç—ã
- `CARD` - –∫–∞—Ä—Ç—ã

**–û—Ç–≤–µ—Ç:**
---
```json
{
  "products": [
    {
      "productId": "prod-001",
      "productType": "DEPOSIT",
      "productName": "–ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π –≤–∫–ª–∞–¥",
      "rate": "8.5",
      "minAmount": "10000",
      "maxAmount": "5000000",
      "currency": "RUB"
    }
  ]
}
```
---

#### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Å–µ–Ω—Ç–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞

---
```http
POST /api/pa-consents?bank=vbank&user=user123
Content-Type: application/json

{
  "productId": "prod-001"
}
```
---

#### –û—Ç–∫—Ä—ã—Ç–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞

---
```http
POST /api/agreements?bank=vbank&user=user123
Content-Type: application/json

{
  "productAgreementConsentId": "pa-consent-uuid",
  "productId": "prod-001",
  "amount": {
    "amount": "50000.00",
    "currency": "RUB"
  }
}
```
---

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–æ–≥–æ–≤–æ—Ä–æ–≤

---
```http
GET /api/agreements?bank=vbank&user=user123
```
---

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –¥–æ–≥–æ–≤–æ—Ä–∞

---
```http
GET /api/agreements/{agreementId}?bank=vbank&user=user123
```
---

#### –ó–∞–∫—Ä—ã—Ç–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞

---
```http
DELETE /api/agreements/{agreementId}?bank=vbank&user=user123
```
---

### Legacy endpoints (–æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)

---
```http
POST /api/banks/{bank}/connect?user=user123
```
---

–°–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Å–µ–Ω—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ legacy —Ñ–æ—Ä–º–∞—Ç–µ.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

---
```
backend/
‚îú‚îÄ‚îÄ main.go              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞, —Ä–æ—É—Ç–∏–Ω–≥
‚îú‚îÄ‚îÄ config.go            # –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–∞—Ä—Å–∏–Ω–≥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ models.go            # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (Account, Transaction, etc.)
‚îú‚îÄ‚îÄ handlers.go          # HTTP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö endpoints
‚îú‚îÄ‚îÄ middleware.go        # Middleware (CORS, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, recovery, timeout)
‚îú‚îÄ‚îÄ aggregator.go        # –õ–æ–≥–∏–∫–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –±–∞–Ω–∫–æ–≤
‚îú‚îÄ‚îÄ bank_api.go          # –ö–ª–∏–µ–Ω—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å API –æ–¥–Ω–æ–≥–æ –±–∞–Ω–∫–∞
‚îú‚îÄ‚îÄ http_client.go       # HTTP –∫–ª–∏–µ–Ω—Ç —Å retry –ª–æ–≥–∏–∫–æ–π
‚îú‚îÄ‚îÄ go.mod               # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è Go
‚îú‚îÄ‚îÄ go.sum               # Checksums –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ .env.example         # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ .env                 # –†–µ–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è)
‚îî‚îÄ‚îÄ .gitignore           # –ü—Ä–∞–≤–∏–ª–∞ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è git
```
---

### –û–ø–∏—Å–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤

| –§–∞–π–ª | –°—Ç—Ä–æ–∫ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-------|------------|
| `main.go` | 118 | –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤ |
| `handlers.go` | 715 | –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ |
| `aggregator.go` | 593 | –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Å–µ–Ω—Ç–∞–º–∏ |
| `bank_api.go` | 951 | API –∫–ª–∏–µ–Ω—Ç –¥–ª—è –±–∞–Ω–∫–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏ |
| `models.go` | 383 | –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö |
| `middleware.go` | 197 | HTTP middleware (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, CORS, timeout) |
| `http_client.go` | 157 | HTTP –∫–ª–∏–µ–Ω—Ç —Å retry –∏ exponential backoff |
| `config.go` | 101 | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è |

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

### –° –ø–æ–º–æ—â—å—é curl

#### 1. Health check
---
```bash
curl http://localhost:8080/health
```
---

#### 2. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Å–µ–Ω—Ç–∞
---
```bash
curl -X POST "http://localhost:8080/api/consents?bank=vbank&user=testuser"
```
---

#### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—á–µ—Ç–æ–≤
---
```bash
curl "http://localhost:8080/api/accounts?user=testuser&bank=vbank"
```
---

#### 4. –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
---
```bash
curl -X POST "http://localhost:8080/api/payment-consents?bank=vbank&user=testuser" \
  -H "Content-Type: application/json" \
  -d '{
    "debtorAccount": {"identification": "40817810099910004312"},
    "instructedAmount": {"amount": "1000.00", "currency": "RUB"},
    "creditorAccount": {"identification": "40817810099910005678"}
  }'
```
---

### –° –ø–æ–º–æ—â—å—é PowerShell (Windows)

---
```powershell
# Health check
Invoke-RestMethod -Uri "http://localhost:8080/health"

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Å–µ–Ω—Ç–∞
Invoke-RestMethod -Method POST -Uri "http://localhost:8080/api/consents?bank=vbank&user=testuser"

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—á–µ—Ç–æ–≤
Invoke-RestMethod -Uri "http://localhost:8080/api/accounts?user=testuser&bank=vbank"
```
---

### –° –ø–æ–º–æ—â—å—é Postman

1. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:
   - `BASE_URL`: `http://localhost:8080`
   - `BANK`: `vbank`
   - `USER`: `testuser`

2. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ endpoint –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ [API Endpoints](#api-endpoints)

### –° –ø–æ–º–æ—â—å—é Python

---
```python
import requests

BASE_URL = "http://localhost:8080"
BANK = "vbank"
USER = "testuser"

# Health check
response = requests.get(f"{BASE_URL}/health")
print(response.json())

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Å–µ–Ω—Ç–∞
response = requests.post(
    f"{BASE_URL}/api/consents",
    params={"bank": BANK, "user": USER}
)
consent = response.json()
print(f"Consent ID: {consent['consentId']}")

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—á–µ—Ç–æ–≤
response = requests.get(
    f"{BASE_URL}/api/accounts",
    params={"user": USER, "bank": BANK}
)
accounts = response.json()
print(f"Accounts: {accounts}")
```
---

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û—à–∏–±–∫–∞: "Server starting on port 8080" –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ—Ä—Ç 8080 –∑–∞–Ω—è—Ç –¥—Ä—É–≥–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º.

**–†–µ—à–µ–Ω–∏–µ**:
---
```bash
# Windows: –Ω–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø–æ—Ä—Ç—É 8080
netstat -ano | findstr :8080
taskkill /PID <PID> /F

# Linux/macOS
lsof -i :8080
kill -9 <PID>

# –ò–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç –≤ .env:
PORT=3000
```
---

### –û—à–∏–±–∫–∞: "missing required environment variable: TEAM_ID"

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Ñ–∞–π–ª `.env`.

**–†–µ—à–µ–Ω–∏–µ**:
---
```bash
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
```
---

### –û—à–∏–±–∫–∞: "bank not configured: unknownbank"

**–ü—Ä–æ–±–ª–µ–º–∞**: –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–π –±–∞–Ω–∫ –Ω–µ —É–∫–∞–∑–∞–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `BANKS`.

**–†–µ—à–µ–Ω–∏–µ**:
---
```env
# –í —Ñ–∞–π–ª–µ .env –¥–æ–±–∞–≤—å—Ç–µ –±–∞–Ω–∫:
BANKS=vbank,abank,sbank,unknownbank
BASE_URL_UNKNOWNBANK=https://unknownbank.open.bankingapi.ru
```
---

### –û—à–∏–±–∫–∞: "failed to get token from bank API"

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω API –±–∞–Ω–∫–∞.

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `TEAM_ID` –∏ `CLIENT_SECRET` –≤ `.env`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API:
---
```bash
curl https://vbank.open.bankingapi.ru/v1/token
```
---
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –¥–µ—Ç–∞–ª–µ–π –æ—à–∏–±–∫–∏

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞

–°–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç:
- –í—Å–µ –≤—Ö–æ–¥—è—â–∏–µ HTTP –∑–∞–ø—Ä–æ—Å—ã —Å –º–µ—Ç–æ–¥–æ–º, –ø—É—Ç–µ–º –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ Request ID –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- –û—à–∏–±–∫–∏ —Å –¥–µ—Ç–∞–ª—è–º–∏ (–∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)

–ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞:
---
```
[INFO] 2024-01-15T10:30:45Z [req-uuid-...] GET /api/accounts?user=test&bank=vbank 200 234ms
```
---

–î–ª—è –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ debug —Å—Ç—Ä–æ–∫–∏ –≤ `http_client.go`.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°–ª–æ–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

1. **HTTP Layer** (`handlers.go`, `middleware.go`)
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   - Middleware: CORS, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, timeout, recovery

2. **Business Logic Layer** (`aggregator.go`)
   - –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –±–∞–Ω–∫–æ–≤
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Å–µ–Ω—Ç–∞–º–∏ (in-memory cache)
   - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –º–µ–∂–¥—É –±–∞–Ω–∫–æ–≤—Å–∫–∏–º–∏ API

3. **API Integration Layer** (`bank_api.go`)
   - –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å API –æ–¥–Ω–æ–≥–æ –±–∞–Ω–∫–∞
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏ (—Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∏ –∫–∞–∂–¥–æ–≥–æ –±–∞–Ω–∫–∞

4. **Infrastructure Layer** (`http_client.go`, `config.go`)
   - HTTP –∫–ª–∏–µ–Ω—Ç —Å retry –ª–æ–≥–∏–∫–æ–π
   - –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
   - –£—Ç–∏–ª–∏—Ç—ã

### Middleware Pipeline

---
```
Request ‚Üí Recovery ‚Üí RequestID ‚Üí Logging ‚Üí Timeout ‚Üí CORS ‚Üí Handler
```
---

1. **Recovery**: –ü–µ—Ä–µ—Ö–≤–∞—Ç –ø–∞–Ω–∏–∫, –≤–æ–∑–≤—Ä–∞—Ç 500 –æ—à–∏–±–∫–∏
2. **RequestID**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è UUID –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
3. **Logging**: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∞, –ø—É—Ç–∏, —Å—Ç–∞—Ç—É—Å–∞, –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
4. **Timeout**: –¢–∞–π–º–∞—É—Ç 90 —Å–µ–∫—É–Ω–¥ –Ω–∞ –∑–∞–ø—Ä–æ—Å
5. **CORS**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CORS –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

**–¢–æ–∫–µ–Ω—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**:
- –ö–µ—à–∏—Ä—É—é—Ç—Å—è –≤ `BankAPIClient`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏
- –ó–∞—â–∏—Ç–∞ –æ—Ç race conditions —á–µ—Ä–µ–∑ mutex

**–ö–æ–Ωc–µ–Ω—Ç—ã**:
- –ö–µ—à–∏—Ä—É—é—Ç—Å—è –≤ `BankAggregator`
- –ö–ª—é—á: `"bank|userID"`
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API –±–∞–Ω–∫–∞

### Retry Logic

HTTP –∫–ª–∏–µ–Ω—Ç (`http_client.go`) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã:
- –î–æ 3 –ø–æ–ø—ã—Ç–æ–∫
- –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (1s, 2s, 4s)
- –ü–æ–≤—Ç–æ—Ä –ø—Ä–∏ 5xx –æ—à–∏–±–∫–∞—Ö
- –¢–∞–π–º–∞—É—Ç 30 —Å–µ–∫—É–Ω–¥ –Ω–∞ –∑–∞–ø—Ä–æ—Å

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ .env —Ñ–∞–π–ª**
   - –§–∞–π–ª —É–∂–µ –≤ `.gitignore`
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.env.example` –∫–∞–∫ —à–∞–±–ª–æ–Ω

2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ**
   - –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç HTTP
   - –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ reverse proxy (nginx, Caddy)

3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ CORS**
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `CORS_ORIGIN` –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
   - –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `*` –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

4. **–ó–∞—â–∏—Ç–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤**
   - `CLIENT_SECRET` –º–∞—Å–∫–∏—Ä—É–µ—Ç—Å—è –≤ –ª–æ–≥–∞—Ö
   - Bearer —Ç–æ–∫–µ–Ω—ã –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é

## –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

**–í–µ—Ä—Å–∏—è**: 1.0.0
**Go –≤–µ—Ä—Å–∏—è**: 1.25.3+

